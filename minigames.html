<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorio de Minijuegos - Noob to Viral</title>
    <style>
        :root {
            --cyan: #00f2ff;
            --green: #39ff14;
            --red: #ff3131;
            --pink: #ff006e;
            --yellow: #fff200;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0b0e14 0%, #161b22 100%);
            color: #e6edf3;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 30px;
        }

        h1 {
            grid-column: 1 / -1;
            text-align: center;
            color: var(--cyan);
            margin-bottom: 20px;
            font-size: 2rem;
        }

        #menu {
            background: #161b22;
            padding: 20px;
            border-radius: 12px;
            height: fit-content;
            border: 2px solid #30363d;
        }

        #menu h2 {
            color: var(--yellow);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .menu-btn {
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            background: #21262d;
            color: var(--cyan);
            border: 1px solid #30363d;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .menu-btn:hover {
            background: #30363d;
            transform: translateX(5px);
        }

        .menu-btn.active {
            background: var(--cyan);
            color: #0b0e14;
            font-weight: bold;
        }

        #game-area {
            background: #161b22;
            border: 2px solid #30363d;
            border-radius: 12px;
            padding: 20px;
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }

        #header {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        #game-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        canvas {
            max-width: 100%;
            border-radius: 8px;
        }

        #dom-game-wrap {
            width: 100%;
            max-width: 500px;
            padding: 20px;
        }

        .game-input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--cyan);
            border-radius: 8px;
            color: #fff;
            font-size: 1.2rem;
            text-align: center;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 400px;
            margin: 20px auto;
        }

        .mem-card {
            aspect-ratio: 1;
            background: #30363d;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .mem-card:hover {
            transform: scale(1.05);
        }

        .sort-item {
            padding: 15px;
            background: #30363d;
            border: 2px solid #444;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 8px;
            transition: all 0.2s;
        }

        .sort-item:hover {
            background: #444;
        }

        .btn {
            padding: 12px 24px;
            background: #21262d;
            color: var(--cyan);
            border: 2px solid var(--cyan);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--cyan);
            color: #0b0e14;
        }

        #result-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 20px;
            border-radius: 8px;
        }

        #result-overlay h2 {
            font-size: 3rem;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üéÆ Laboratorio de Minijuegos</h1>

        <div id="menu">
            <h2>Selecciona un juego:</h2>
            <button class="menu-btn" onclick="play('clicker')">1. Reflejos R√°pidos</button>
            <button class="menu-btn" onclick="play('maze')">2. Laberinto</button>
            <button class="menu-btn" onclick="play('memory')">3. Memotest 4x4</button>
            <button class="menu-btn" onclick="play('word')">4. Decodificador</button>
            <button class="menu-btn" onclick="play('sorter')">5. Ordenador L√≥gico</button>
            <button class="menu-btn" onclick="play('neuro')">6. Neuro-Patr√≥n</button>
            <button class="menu-btn" onclick="play('search')">7. Caza del Intruso</button>
            <button class="menu-btn" onclick="play('math')">8. C√°lculo R√°pido</button>
            <button class="menu-btn" onclick="play('reaction')">9. Reflejo Puro</button>
            <button class="menu-btn" onclick="play('collector')">10. Recolector</button>
        </div>

        <div id="game-area">
            <div id="header">
                <span>‚è±Ô∏è Tiempo: <span id="timer">0</span>s</span>
                <span>üìä Puntos: <span id="score">0</span></span>
            </div>
            <div id="game-container">
                <canvas id="canvas-game" style="display:none"></canvas>
                <div id="dom-game-wrap" style="display:none"></div>
                <div id="result-overlay">
                    <h2 id="result-title">RESULTADO</h2>
                    <button class="btn" onclick="hideResult()">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let mgInt, mgAnim, mScore = 0, mTimer = 0, mLives = 3, currentWord = "", currentGameId = "";
        let mgTimeouts = [], mgIntervals = [], mgActive = false;

        function clearMGStuff() {
            clearInterval(mgInt);
            if (mgAnim) cancelAnimationFrame(mgAnim);
            mgTimeouts.forEach(t => clearTimeout(t));
            mgIntervals.forEach(i => clearInterval(i));
            mgTimeouts = []; mgIntervals = [];
        }

        function updateHeader() {
            document.getElementById('timer').innerText = mTimer;
            document.getElementById('score').innerText = mScore;
        }

        function endGame(win) {
            if (!mgActive) return;
            mgActive = false;
            clearMGStuff();
            document.getElementById('result-overlay').style.display = 'flex';
            document.getElementById('result-title').innerText = win ? "‚úÖ ¬°VICTORIA!" : "‚ùå FALLASTE";
            document.getElementById('result-title').style.color = win ? "var(--green)" : "var(--red)";
        }

        function hideResult() {
            document.getElementById('result-overlay').style.display = 'none';
        }

        function play(gameId) {
            // Reset
            clearMGStuff();
            document.getElementById('canvas-game').style.display = 'none';
            document.getElementById('dom-game-wrap').style.display = 'none';
            hideResult();
            mScore = 0;
            mLives = 3;
            currentGameId = gameId;
            mgActive = true;

            // Highlight active button
            document.querySelectorAll('.menu-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Start game
            switch (gameId) {
                case 'clicker': mTimer = 15; initClicker(); break;
                case 'maze': mTimer = 20; initMaze(); break;
                case 'memory': mTimer = 30; initMemory(); break;
                case 'word': mTimer = 15; initWord(); break;
                case 'sorter': mTimer = 15; initSorter(); break;
                case 'neuro': mTimer = 25; initNeuro(); break;
                case 'search': mTimer = 10; initSearch(); break;
                case 'math': mTimer = 15; initMath(); break;
                case 'reaction': mTimer = 10; initReaction(); break;
                case 'collector': mTimer = 20; initCollector(); break;
            }

            mgInt = setInterval(() => {
                mTimer--;
                updateHeader();
                if (mTimer <= 0) endGame(false);
            }, 1000);
            updateHeader();
        }

        // ===== MINIGAME IMPLEMENTATIONS =====

        function initClicker() {
            const c = document.getElementById('canvas-game');
            c.style.display = 'block';
            const ctx = c.getContext('2d');
            c.width = 400;
            c.height = 500;
            let items = [];

            function loop() {
                ctx.clearRect(0, 0, c.width, c.height);
                if (Math.random() < 0.025 && items.length < 4) {
                    const isBomb = Math.random() < 0.25;
                    items.push({
                        x: Math.random() * 320 + 40,
                        y: Math.random() * 420 + 40,
                        icon: isBomb ? 'üí£' : 'üéÆ',
                        isBomb: isBomb,
                        life: 240,
                        maxLife: 240,
                        scale: 0
                    });
                }
                for (let i = items.length - 1; i >= 0; i--) {
                    let it = items[i];
                    it.life--;
                    if (it.life > 220) it.scale = (240 - it.life) / 20;
                    else if (it.life < 20) it.scale = it.life / 20;
                    else it.scale = 1;

                    ctx.save();
                    ctx.translate(it.x, it.y);
                    ctx.scale(it.scale, it.scale);
                    ctx.font = "45px Arial";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText(it.icon, 0, 0);
                    ctx.fillStyle = it.isBomb ? "red" : "lime";
                    ctx.fillRect(-20, 30, 40 * (it.life / it.maxLife), 4);
                    ctx.restore();

                    if (it.life <= 0) items.splice(i, 1);
                }
                mgAnim = requestAnimationFrame(loop);
            }
            loop();

            const handleHit = (clientX, clientY) => {
                const r = c.getBoundingClientRect();
                const scaleX = c.width / r.width;
                const scaleY = c.height / r.height;
                const mx = (clientX - r.left) * scaleX;
                const my = (clientY - r.top) * scaleY;

                for (let i = items.length - 1; i >= 0; i--) {
                    let it = items[i];
                    if (Math.hypot(mx - it.x, my - it.y) < 45) {
                        if (it.isBomb) {
                            endGame(false);
                        } else {
                            mScore++;
                            updateHeader();
                            items.splice(i, 1);
                            if (mScore >= 10) endGame(true);
                        }
                        break;
                    }
                }
            };

            c.onmousedown = (e) => handleHit(e.clientX, e.clientY);
            c.ontouchstart = (e) => {
                e.preventDefault();
                handleHit(e.touches[0].clientX, e.touches[0].clientY);
            };
        }

        function initMaze() {
            const c = document.getElementById('canvas-game');
            c.style.display = 'block';
            const ctx = c.getContext('2d');
            c.width = 400;
            c.height = 500;
            let dragging = false;
            let ballX = 60, ballY = 60;
            const track = [
                { x: 30, y: 30, w: 80, h: 100 },
                { x: 30, y: 100, w: 50, h: 350 },
                { x: 30, y: 400, w: 340, h: 50 },
                { x: 320, y: 150, w: 50, h: 300 },
                { x: 150, y: 150, w: 220, h: 50 },
                { x: 150, y: 150, w: 50, h: 150 }
            ];
            const goal = { x: 175, y: 275 };

            function draw() {
                ctx.fillStyle = "#ff3131";
                ctx.fillRect(0, 0, 400, 500);
                ctx.fillStyle = "#00f2ff";
                track.forEach(t => ctx.fillRect(t.x, t.y, t.w, t.h));
                ctx.fillStyle = "#fff";
                ctx.beginPath();
                ctx.arc(60, 60, 15, 0, 7);
                ctx.fill();
                ctx.fillStyle = "#fff200";
                ctx.beginPath();
                ctx.arc(goal.x, goal.y, 20, 0, 7);
                ctx.fill();
                ctx.fillStyle = "#39ff14";
                ctx.beginPath();
                ctx.arc(ballX, ballY, 12, 0, 7);
                ctx.fill();
                mgAnim = requestAnimationFrame(draw);
            }
            draw();

            const getPos = (e) => {
                const r = c.getBoundingClientRect();
                return {
                    x: (e.clientX - r.left) * (c.width / r.width),
                    y: (e.clientY - r.top) * (c.height / r.height)
                };
            };

            const handleMove = (e) => {
                if (!dragging) return;
                e.preventDefault();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                const p = getPos({ clientX, clientY });
                ballX = p.x;
                ballY = p.y;
                if (!track.some(t => p.x > t.x && p.x < t.x + t.w && p.y > t.y && p.y < t.y + t.h)) {
                    dragging = false;
                    ballX = 60;
                    ballY = 60;
                    endGame(false);
                }
                if (Math.hypot(p.x - goal.x, p.y - goal.y) < 20) {
                    dragging = false;
                    endGame(true);
                }
            };

            const handleStart = (e) => {
                e.preventDefault();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                const p = getPos({ clientX, clientY });
                if (Math.hypot(p.x - ballX, p.y - ballY) < 30) dragging = true;
            };

            const handleEnd = () => {
                dragging = false;
                if (Math.hypot(ballX - goal.x, ballY - goal.y) > 20) {
                    ballX = 60;
                    ballY = 60;
                }
            };

            c.onmousedown = handleStart;
            c.ontouchstart = handleStart;
            window.onmousemove = handleMove;
            window.ontouchmove = handleMove;
            window.onmouseup = handleEnd;
            window.ontouchend = handleEnd;
        }

        function initMemory() {
            const d = document.getElementById('dom-game-wrap');
            d.style.display = 'block';
            d.innerHTML = '<h3 style="text-align:center; margin-bottom:20px;">Encuentra los 4 pares</h3><div class="memory-grid" id="mg"></div>';
            const base = ['üéÆ', 'üñ±Ô∏è', 'üéß', '‚å®Ô∏è']; // 4 icons for 8 cards
            let cards = [...base, ...base].sort(() => Math.random() - 0.5);
            let flipped = [];
            let matches = 0;

            cards.forEach(emoji => {
                let el = document.createElement('div');
                el.className = 'mem-card';
                el.onclick = () => {
                    if (flipped.length < 2 && !el.innerText && !el.classList.contains('matched')) {
                        el.innerText = emoji;
                        flipped.push(el);
                        if (flipped.length === 2) {
                            if (flipped[0].innerText === flipped[1].innerText) {
                                matches++;
                                flipped[0].classList.add('matched');
                                flipped[1].classList.add('matched');
                                flipped = [];
                                if (matches === 4) endGame(true);
                            } else {
                                setTimeout(() => {
                                    flipped[0].innerText = '';
                                    flipped[1].innerText = '';
                                    flipped = [];
                                }, 600);
                            }
                        }
                    }
                };
                document.getElementById('mg').appendChild(el);
            });
        }

        function initWord() {
            const d = document.getElementById('dom-game-wrap');
            d.style.display = 'block';
            const words = ['PODER', 'META', 'IDEAS', 'LOGRO', 'CAMBIO', 'VALOR', 'PREGUNTAR', 'PROCESO', 'MENTE', 'ESFUERZO'];
            currentWord = words[Math.floor(Math.random() * words.length)];
            let scrambled = currentWord.split('');
            if (scrambled.length > 3) {
                for (let i = scrambled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [scrambled[i], scrambled[j]] = [scrambled[j], scrambled[i]];
                }
                if (scrambled.join('') === currentWord) {
                    [scrambled[0], scrambled[1]] = [scrambled[1], scrambled[0]];
                }
            } else {
                scrambled.reverse();
            }
            d.innerHTML = `<h3 style="margin-bottom:20px;">ORDENA: <span style="color:var(--cyan); letter-spacing:5px;">${scrambled.join('')}</span></h3><input type="text" id="winin" class="game-input">`;
            const ipt = document.getElementById('winin');
            ipt.focus();
            ipt.oninput = () => {
                if (ipt.value.toUpperCase() === currentWord) endGame(true);
            };
        }

        function initSorter() {
            const d = document.getElementById('dom-game-wrap');
            d.style.display = 'block';
            let nums = [10, 25, 50, 75, 99].sort((a, b) => a - b);
            let shuffled = [...nums].sort(() => Math.random() - 0.5);
            d.innerHTML = '<h3 style="text-align:center; margin-bottom:20px;">Ordena de MENOR a MAYOR</h3><div id="sc"></div>';
            shuffled.forEach(x => {
                let b = document.createElement('div');
                b.className = 'sort-item';
                b.innerText = x;
                b.onclick = () => {
                    if (x === nums[0]) {
                        nums.shift();
                        b.style.background = 'var(--green)';
                        b.style.color = '#000';
                        if (!nums.length) endGame(true);
                    } else {
                        b.style.background = 'var(--red)';
                        setTimeout(() => b.style.background = '#30363d', 300);
                    }
                };
                document.getElementById('sc').appendChild(b);
            });
        }

        function initNeuro() {
            const d = document.getElementById('dom-game-wrap');
            d.style.display = 'block';
            const emojis = ['üöÄ', 'üî•', 'üíé', '‚ö°'];
            let seq = [];
            for (let i = 0; i < 4; i++) seq.push(Math.floor(Math.random() * 4));
            let uSeq = [];
            d.innerHTML = `<h3>MEMORIZA LA SECUENCIA:</h3><div id="nbox" style="width:100%;height:100px;border-radius:10px;margin:20px 0;border:2px solid #fff;display:flex;justify-content:center;align-items:center;font-size:3.5rem;"></div><div id="nbtns" style="display:flex;gap:5px;"></div>`;
            let i = 0;
            let iv = setInterval(() => {
                const box = document.getElementById('nbox');
                if (box) {
                    box.innerText = emojis[seq[i]];
                    mgTimeouts.push(setTimeout(() => { if (box) box.innerText = ''; }, 500));
                    i++;
                    if (i >= 4) {
                        clearInterval(iv);
                        mgTimeouts.push(setTimeout(() => enable(), 600));
                    }
                }
            }, 1000);
            mgIntervals.push(iv);

            function enable() {
                const ctr = document.getElementById('nbtns');
                ctr.innerHTML = '';
                emojis.forEach((em, idx) => {
                    const b = document.createElement('button');
                    b.className = 'btn';
                    b.style.flex = "1";
                    b.style.height = "70px";
                    b.style.fontSize = "2rem";
                    b.innerText = em;
                    b.style.touchAction = "none";
                    b.onpointerdown = () => {
                        b.style.background = "rgba(255,255,255,0.2)";
                    };
                    b.onpointerup = () => {
                        b.style.background = "transparent";
                        check(idx);
                    };
                    b.onpointerleave = () => {
                        b.style.background = "transparent";
                    };
                    ctr.appendChild(b);
                });
            }

            function check(idx) {
                uSeq.push(idx);
                if (idx !== seq[uSeq.length - 1]) {
                    const box = document.getElementById('nbox');
                    box.style.fontSize = "1.2rem";
                    box.style.flexDirection = "column";
                    box.innerHTML = `<span style="color:var(--red)">Tu: ${uSeq.map(x => emojis[x]).join(' ')}</span>
                                     <span style="color:var(--green)">Era: ${seq.map(x => emojis[x]).join(' ')}</span>`;
                    setTimeout(() => endGame(false), 2500);
                } else {
                    if (uSeq.length === 4) endGame(true);
                }
            }
        }

        function initSearch() {
            const d = document.getElementById('dom-game-wrap');
            d.style.display = 'block';
            d.innerHTML = '<h3 style="text-align:center; margin-bottom:20px;">ENCUENTRA EL INTRUSO:</h3><div class="memory-grid" id="sgrid"></div>';

            // Extended Categories for variety (at least 15 each)
            const categories = [
                { name: 'animales', items: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'üêî', 'üêß', 'üê¶', 'ü¶â'] },
                { name: 'frutas', items: ['üçé', 'üçå', 'üçí', 'üçá', 'üçâ', 'üçç', 'ü•ù', 'üçã', 'üçë', 'üçê', 'üçì', 'ü´ê', 'üçä', 'üçà', 'üçè', 'ü•≠', 'ü••'] },
                { name: 'objetos', items: ['‚öΩ', 'üèÄ', 'üéæ', 'üèê', 'üé±', 'üèà', '‚öæ', 'ü•é', 'üé≥', 'üèì', 'üé∏', 'üé®', 'üì∑', 'üîç', 'üéß', 'üíª', 'üì±', '‚åö', 'üéÆ'] },
                { name: 'comida', items: ['üçï', 'üçî', 'üçü', 'üå≠', 'üçø', 'üßÇ', 'ü•ì', 'üç≥', 'üßá', 'ü•û', 'üçû', 'ü•ê', 'ü•®', 'ü•Ø', 'üßÄ', 'üåÆ', 'üåØ'] }
            ];

            // Pick 2 different categories
            const shuffled = [...categories].sort(() => Math.random() - 0.5);
            const mainCat = shuffled[0];
            const intruderCat = shuffled[1];

            // Shuffle main category items and take 15 DIFFERENT ones
            let mainItems = [...mainCat.items].sort(() => Math.random() - 0.5).slice(0, 15);

            // Pick 1 random intruder from the other category
            const intruder = intruderCat.items[Math.floor(Math.random() * intruderCat.items.length)];

            // Combine: 15 unique items from main cat + 1 intruder
            let cards = [...mainItems, intruder];
            cards.sort(() => Math.random() - 0.5);

            cards.forEach(e => {
                const c = document.createElement('div');
                c.className = 'mem-card';
                c.innerText = e;
                c.style.fontSize = "2.2rem";
                c.onclick = () => {
                    if (e === intruder) endGame(true);
                    else endGame(false);
                };
                document.getElementById('sgrid').appendChild(c);
            });
        }

        function initMath() {
            const d = document.getElementById('dom-game-wrap');
            d.style.display = 'block';
            let count = 0;
            const next = () => {
                count++;
                if (count > 3) {
                    endGame(true);
                    return;
                }
                const a = Math.floor(Math.random() * 15) + 1;
                const b = Math.floor(Math.random() * 15) + 1;
                const op = Math.random() > 0.5 ? '+' : '-';
                // Ensure positive result
                let num1 = a, num2 = b;
                if (op === '-' && b > a) { num1 = b; num2 = a; }
                const ans = op === '+' ? num1 + num2 : num1 - num2;
                d.innerHTML = `<h3>RESOLVER (${count}/3):</h3><div style="font-size:3rem; margin:20px 0;">${num1} ${op} ${num2} = ?</div><input type="number" id="math-in" class="game-input" pattern="[0-9]*" inputmode="numeric">`;
                const ipt = document.getElementById('math-in');
                ipt.focus();
                ipt.oninput = () => {
                    if (parseInt(ipt.value) === ans) next();
                };
            };
            next();
        }

        function initReaction() {
            const d = document.getElementById('dom-game-wrap');
            d.style.display = 'block';
            d.innerHTML = '<div id="react-box" style="width:100%; height:300px; background:var(--red); border-radius:15px; display:flex; justify-content:center; align-items:center; font-size:1.5rem; font-weight:bold; cursor:pointer;">ESPERA...</div>';
            const box = document.getElementById('react-box');
            let ready = false;
            let start = 0;
            let delay = 2000 + Math.random() * 3000;
            let tout = setTimeout(() => {
                ready = true;
                box.style.background = "var(--green)";
                box.innerText = "¬°YA! TOCA AQU√ç";
                start = Date.now();
                // Auto-fail after 500ms
                mgTimeouts.push(setTimeout(() => {
                    if (mgActive && ready) {
                        box.style.background = "var(--red)";
                        box.innerText = "¬°MUY LENTO!";
                        mgTimeouts.push(setTimeout(() => endGame(false), 500));
                    }
                }, 500));
            }, delay);
            mgTimeouts.push(tout);

            const handle = () => {
                if (!ready) {
                    endGame(false);
                } else {
                    const diff = Date.now() - start;
                    if (diff <= 500) endGame(true);
                    else endGame(false);
                }
            };
            box.onmousedown = (e) => {
                e.preventDefault();
                handle();
            };
            box.ontouchstart = (e) => {
                e.preventDefault();
                handle();
            };
        }

        function initCollector() {
            const c = document.getElementById('canvas-game');
            c.style.display = 'block';
            const ctx = c.getContext('2d');
            c.width = 400;
            c.height = 500;
            let basketX = 170;
            let items = [];
            let stars = 0;

            function loop() {
                ctx.clearRect(0, 0, c.width, c.height);

                // Instructions
                ctx.fillStyle = "#888";
                ctx.font = "12px Arial";
                ctx.textAlign = "center";
                ctx.fillText("Atrapa ‚≠ê | Evita ‚òÑÔ∏è", 200, 15);

                ctx.fillStyle = "var(--cyan)";
                ctx.fillRect(basketX, 450, 60, 20);
                if (Math.random() < 0.025) {
                    const isBad = Math.random() < 0.25;
                    items.push({
                        x: Math.random() * 370,
                        y: -20,
                        isBad,
                        icon: isBad ? '‚òÑÔ∏è' : '‚≠ê',
                        speed: 2 + Math.random() * 2
                    });
                }
                for (let i = items.length - 1; i >= 0; i--) {
                    let it = items[i];
                    it.y += it.speed;
                    ctx.font = "30px Arial";
                    ctx.textAlign = "center";
                    ctx.fillText(it.icon, it.x + 15, it.y);
                    if (it.y > 450 && it.y < 480 && it.x > basketX - 20 && it.x < basketX + 60) {
                        if (it.isBad) {
                            endGame(false);
                            return;
                        } else {
                            stars++;
                            mScore = stars;
                            updateHeader();
                            items.splice(i, 1);
                            if (stars >= 10) {
                                endGame(true);
                                return;
                            }
                        }
                    } else if (it.y > 520) items.splice(i, 1);
                }
                mgAnim = requestAnimationFrame(loop);
            }
            loop();

            const handle = (clientX) => {
                const r = c.getBoundingClientRect();
                basketX = (clientX - r.left) * (c.width / r.width) - 30;
                if (basketX < 0) basketX = 0;
                if (basketX > 340) basketX = 340;
            };
            c.onmousemove = (e) => handle(e.clientX);
            c.ontouchmove = (e) => {
                e.preventDefault();
                handle(e.touches[0].clientX);
            };
        }
    </script>
</body>

</html>